---
import { languages } from '../i18n/ui';
import { getLangFromUrl } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const currentUrl = Astro.url.pathname;
const isNepali = lang === 'ne';

function getLocalizedPath(language: string) {
  const segments = currentUrl.split('/').filter(Boolean);
  
  if (segments.length > 0 && segments[0] in languages) {
    segments[0] = language;
  } else {
    segments.unshift(language);
  }
  
  return `/${segments.join('/')}`;
}
---

<div class="language-switch">
  <a href={getLocalizedPath('en')} class:list={["lang-option", { active: !isNepali }]}>EN</a>
  <span class="switch-divider">|</span>
  <a href={getLocalizedPath('ne')} class:list={["lang-option", { active: isNepali }]}>рдиреЗ</a>
</div>

<style>
  .language-switch {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background-color: rgba(255, 255, 255, 0.1);
    padding: 0.35rem 0.6rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .lang-option {
    color: rgba(255, 255, 255, 0.6);
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .lang-option:hover {
    color: var(--color-white);
  }

  .lang-option.active {
    color: var(--color-white);
    background-color: rgba(255, 255, 255, 0.2);
  }

  .switch-divider {
    color: rgba(255, 255, 255, 0.3);
  }

  /* Dark mode adjustments */
  :global([data-theme="dark"]) .language-switch {
    background-color: rgba(255, 255, 255, 0.05);
  }

  :global([data-theme="dark"]) .lang-option {
    color: rgba(255, 255, 255, 0.5);
  }

  :global([data-theme="dark"]) .lang-option.active {
    color: var(--color-white);
    background-color: rgba(255, 255, 255, 0.15);
  }
</style>

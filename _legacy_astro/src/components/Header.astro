---
import { getRelativeLocaleUrl } from 'astro:i18n';
import { useTranslations } from '../i18n/ui';
import LanguagePicker from './LanguagePicker.astro';
import ThemeToggle from './ThemeToggle.astro';

const { lang = 'en' } = Astro.props; // Receive lang from Layout
const t = useTranslations(lang);

// Helper for links
function l(path: string) {
    return getRelativeLocaleUrl(lang, path);
}

---

<header class="bg-header-bg text-header-text py-4 sticky top-0 z-50 shadow-md">
  <div class="container mx-auto px-4 flex justify-between items-center">
    <div class="logo">
      <a href="/">
        <span class="font-heading text-3xl font-bold text-white">GTBM</span>
      </a>
    </div>

    <nav class="group flex items-center md:gap-8" id="nav-menu">
      {/* Mobile Menu Container - Hidden by default on mobile, shown when active */}
      <div class="fixed left-[-100%] top-[80px] w-full h-[calc(100vh-80px)] bg-primary flex flex-col items-center pt-8 gap-6 transition-[left] duration-300 md:static md:w-auto md:h-auto md:bg-transparent md:flex-row md:pt-0 md:gap-8 nav-list-container">
          <ul class="flex flex-col gap-6 items-center md:flex-row md:gap-8 m-0 p-0 list-none">
            <li><a href={l('')} class="text-white font-semibold text-base p-2 hover:text-secondary transition-colors">{t('nav.home')}</a></li>
            
            <li class="relative group/dropdown">
              <a href={l('about')} class="text-white font-semibold text-base p-2 hover:text-secondary transition-colors cursor-pointer group-hover/dropdown:text-secondary inline-flex items-center gap-1">
                  {t('nav.about')} ▾
              </a>
              <ul class="absolute top-full left-0 bg-white min-w-[220px] shadow-md rounded-lg hidden flex-col py-2 z-[1001] group-hover/dropdown:flex md:group-hover/dropdown:flex text-left">
                <li><a href={l('about#profile')} class="text-text px-4 py-3 block hover:bg-light-gray hover:text-primary transition-colors">Company Profile</a></li>
                <li><a href={l('about#director')} class="text-text px-4 py-3 block hover:bg-light-gray hover:text-primary transition-colors">Message from Director</a></li>
              </ul>
            </li>

            <li class="relative group/dropdown">
              <a href={l('services')} class="text-white font-semibold text-base p-2 hover:text-secondary transition-colors cursor-pointer group-hover/dropdown:text-secondary inline-flex items-center gap-1">
                  {t('nav.services')} ▾
              </a>
              <ul class="absolute top-full left-0 bg-white min-w-[220px] shadow-md rounded-lg hidden flex-col py-2 z-[1001] group-hover/dropdown:flex md:group-hover/dropdown:flex text-left">
                <li><a href={l('services#real-estate')} class="text-text px-4 py-3 block hover:bg-light-gray hover:text-primary transition-colors">Real Estate</a></li>
                <li><a href={l('services#construction')} class="text-text px-4 py-3 block hover:bg-light-gray hover:text-primary transition-colors">Construction & Thekka</a></li>
                <li><a href={l('services#design')} class="text-text px-4 py-3 block hover:bg-light-gray hover:text-primary transition-colors">2D/3D Design</a></li>
                <li><a href={l('services#plotting')} class="text-text px-4 py-3 block hover:bg-light-gray hover:text-primary transition-colors">Plotting Services</a></li>
                <li><a href={l('services#maintenance')} class="text-text px-4 py-3 block hover:bg-light-gray hover:text-primary transition-colors">Plumbing & Maintenance</a></li>
              </ul>
            </li>

            <li><a href={l('projects')} class="text-white font-semibold text-base p-2 hover:text-secondary transition-colors">{t('nav.projects')}</a></li>
            <li><a href={l('contact')} class="text-white font-semibold text-base p-2 hover:text-secondary transition-colors">{t('nav.contact')}</a></li>
          </ul>
          
          <div class="flex md:hidden items-center gap-4 mt-4">
              <LanguagePicker />
              <ThemeToggle />
          </div>
      </div>
    </nav>
    
    <div class="hidden md:flex items-center gap-4 ml-4">
        <LanguagePicker />
        <ThemeToggle />
    </div>

    <button class="md:hidden bg-transparent border-none cursor-pointer block" id="hamburger" aria-label="Toggle Menu">
      <span class="bar block w-[25px] h-[3px] my-[5px] mx-auto bg-white transition-all duration-300"></span>
      <span class="bar block w-[25px] h-[3px] my-[5px] mx-auto bg-white transition-all duration-300"></span>
      <span class="bar block w-[25px] h-[3px] my-[5px] mx-auto bg-white transition-all duration-300"></span>
    </button>
  </div>
</header>

<script>
  const hamburger = document.getElementById('hamburger');
  const navContainer = document.querySelector('.nav-list-container');

  if (hamburger && navContainer) {
    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navContainer.classList.toggle('!left-0'); // Use Tailwind-compatible toggle class or custom style
      
      // Toggle hamburger animation
      const bars = hamburger.querySelectorAll('.bar');
      if (hamburger.classList.contains('active')) {
          // Simple cross animation manually or via classes if preferred
          // For now just toggle visibility logic
      }
    });
  }
</script>
